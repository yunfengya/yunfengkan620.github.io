"use strict";(self["webpackChunkadmin_pc"]=self["webpackChunkadmin_pc"]||[]).push([[710],{3710:function(e,t,n){n.r(t),n.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"contain_box"},[e._m(0),t("div",{staticStyle:{width:"98%",height:"98%",border:"1px solid gray"},attrs:{id:"container"},on:{dblclick:e.toggleFullScreen,mousemove:e.mouseMove}},[t("div",{style:{left:e.state.planePos.left,top:e.state.planePos.top,display:e.state.planeDisplay},attrs:{id:"plane"}},[t("p",[e._v("机柜名称："+e._s(e.state.curCabinet.name))]),t("p",[e._v("机柜温度："+e._s(e.state.curCabinet.temperature)+"°")]),t("p",[e._v("使用情况："+e._s(e.state.curCabinet.count)+" / "+e._s(e.state.curCabinet.capacity))])])])])},a=[function(){var e=this,t=e._self._c;return t("div",[e._v("在外部建模上修改"),t("a",{attrs:{href:"https://juejin.cn/post/7171075542882451463?",target:"_blanck"}},[e._v("链接参考")])])}],s=(n(6699),n(9477)),r=n(9365),o=n(7836),c={data(){return{mesh:null,camera:null,scene:null,renderer:null,controls:null,maps:null,cabinets:[],curCabinet:null,originalMaterials:new Map,state:{planePos:{left:0,top:0},planeDisplay:"none",curCabinet:{name:"Loading……",temperature:0,capacity:0,count:0}}}},mounted(){this.maps=new Map,this.crtTexture("cabinet-hover.jpg"),this.init(),window.addEventListener("resize",this.onWindowResize)},beforeDestroy(){window.removeEventListener("resize",this.onWindowResize)},methods:{init(){this.createScene(),this.loadGLTF(),this.createLight(),this.createCamera(),this.createRender(),this.createControls(),this.render()},createScene(){this.scene=new s.xsS},loadGLTF(){const e=new o.E;e.load("/threejsFile/models/machineRoom.gltf",(({scene:{children:e}})=>{e.forEach((e=>{const{map:t,color:n}=e.material;this.changeMat(e,t,n),e.name.includes("cabinet")&&(this.cabinets.push(e),this.originalMaterials.set(e.uuid,e.material))})),this.scene.add(...e)}))},changeMat(e,t,n){e.material=t?new s.vBJ({map:this.crtTexture(t.name)}):new s.vBJ({color:n})},crtTexture(e){let t=this.maps.get(e);return t||(t=(new s.dpR).load("/threejsFile/models/"+e),t.flipY=!1,t.wrapS=1e3,t.wrapT=1e3,this.maps.set(e,t)),t},hover_cabinet_fn(){this.maps=new Map,this.crtTexture("cabinet-hover.jpg")},mouseMove(e){const t=document.getElementById("container"),{clientX:n,clientY:i}=e,a=t.getBoundingClientRect(),s=n-a.left,r=i-a.top;this.selectCabinet(s,r),this.hover_cabinet_fn()},onMouseOverCabinet(e){console.log(e),this.state.planeDisplay="block"},onMouseMoveCabinet(e,t){console.log(e,t),this.state.planePos.left=e+0+"px",this.state.planePos.top=t+80+"px"},onMouseOutCabinet(){this.state.planeDisplay="none"},selectCabinet(e,t){const{cabinets:n,renderer:i,camera:a,maps:r,curCabinet:o,originalMaterials:c}=this,{width:l,height:h}=i.domElement,d=new s.iMs,u=new s.FM8;u.set(e/l*2-1,-t/h*2+1),d.setFromCamera(u,a);const m=d.intersectObjects(n);let p=m.length>0?m[0].object:null;if(o&&o!==p){const e=c.get(o.uuid);e&&(o.material=e,o.material.needsUpdate=!0)}if(p){if(this.onMouseMoveCabinet(e,t),p!==o){this.curCabinet=p;p.material;const e=c.get(p.uuid);e&&(p.material=new s.vBJ({map:this.crtTexture("cabinet-hover.jpg")}),p.material.needsUpdate=!0),this.onMouseOverCabinet(p)}}else o&&(this.curCabinet=null,this.onMouseOutCabinet())},createLight(){const e=new s.Mig(16777215,.1);this.scene.add(e);const t=new s.PMe(16777215);t.position.set(150,150,150),t.castShadow=!0,this.scene.add(t)},createCamera(){const e=document.getElementById("container"),t=e.clientWidth,n=e.clientHeight,i=t/n;this.camera=new s.cPb(45,i,.1,1e3),this.camera.position.set(0,10,15),this.camera.lookAt(0,0,0),this.scene.add(this.camera)},createRender(){const e=document.getElementById("container");this.renderer=new s.CP7({antialias:!0,alpha:!0}),this.renderer.setSize(e.clientWidth,e.clientHeight),this.renderer.setClearColor(4144959,1),this.renderer.shadowMap.enabled=!0,e.appendChild(this.renderer.domElement)},render(){this.renderer.render(this.scene,this.camera),this.controls.update(),requestAnimationFrame(this.render)},createControls(){this.controls=new r.z(this.camera,this.renderer.domElement),this.controls.enableDamping=!0,this.controls.dampingFactor=.25,this.controls.enableZoom=!0,this.controls.enablePan=!0},onWindowResize(){const e=document.getElementById("container");this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(e.clientWidth,e.clientHeight)},toggleFullScreen(){const e=document.getElementById("container");document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():e.requestFullscreen()}}},l=c,h=n(1001),d=(0,h.Z)(l,i,a,!1,null,"d61762a4",null),u=d.exports}}]);